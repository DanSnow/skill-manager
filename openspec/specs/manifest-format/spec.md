# manifest-format Specification

## Purpose
TBD - created by archiving change skill-manager-mvp. Update Purpose after archive.
## Requirements
### Requirement: plugins.toml manifest structure

The system SHALL support a `plugins.toml` manifest file with two sections: `[marketplaces]` for declaring plugin sources and `[plugins]` for declaring desired plugins.

#### Scenario: Parse minimal manifest
- **WHEN** a manifest contains only `[marketplaces]` and `[plugins]` sections
- **THEN** the system parses it successfully

#### Scenario: Empty manifest is valid
- **WHEN** a manifest contains empty `[marketplaces]` and `[plugins]` sections
- **THEN** the system parses it as having zero marketplaces and zero plugins

### Requirement: Marketplace declaration formats

The system SHALL support three marketplace URL formats:
1. GitHub shorthand: `owner/repo`
2. SSH URL: `git@github.com:owner/repo.git`
3. HTTPS URL: `https://example.com/repo.git`

#### Scenario: GitHub shorthand expansion
- **WHEN** a marketplace is declared as `official = "anthropics/claude-plugins-official"`
- **THEN** the system resolves it to `https://github.com/anthropics/claude-plugins-official.git`

#### Scenario: SSH URL passthrough
- **WHEN** a marketplace is declared as `private = "git@github.com:mycompany/plugins.git"`
- **THEN** the system uses the URL as-is for git operations

#### Scenario: HTTPS URL passthrough
- **WHEN** a marketplace is declared as `custom = "https://git.example.com/plugins.git"`
- **THEN** the system uses the URL as-is for git operations

### Requirement: Marketplace version pinning

The system SHALL support pinning marketplaces by tag or commit using inline table syntax.

#### Scenario: Pin marketplace by tag
- **WHEN** a marketplace is declared as `pinned = { url = "owner/repo", tag = "v1.0" }`
- **THEN** the system resolves the tag to a commit hash during installation

#### Scenario: Pin marketplace by commit
- **WHEN** a marketplace is declared as `exact = { url = "owner/repo", commit = "abc123" }`
- **THEN** the system uses that exact commit hash

### Requirement: Plugin declaration

The system SHALL require each plugin entry to specify a `marketplace` key referencing a declared marketplace.

#### Scenario: Plugin references marketplace
- **WHEN** a plugin is declared as `typescript-lsp = { marketplace = "official" }`
- **THEN** the system looks up the plugin in the "official" marketplace

#### Scenario: Plugin with undeclared marketplace
- **WHEN** a plugin references a marketplace not in `[marketplaces]`
- **THEN** the system returns an error indicating the missing marketplace

### Requirement: Plugin version pinning

The system SHALL support pinning plugins by tag or commit, independent of marketplace pinning.

#### Scenario: Pin plugin by tag
- **WHEN** a plugin is declared as `superpowers = { marketplace = "superpowers", tag = "v4.1.1" }`
- **THEN** the system resolves the tag to a commit from the plugin's source

#### Scenario: Pin plugin by commit
- **WHEN** a plugin is declared as `sourceatlas = { marketplace = "sourceatlas", commit = "def456" }`
- **THEN** the system uses that exact commit hash

#### Scenario: Unpinned plugin uses latest
- **WHEN** a plugin has no tag or commit specified
- **THEN** the system uses HEAD of the default branch

### Requirement: plugins.lock structure

The system SHALL generate a `plugins.lock` file containing `[[marketplace]]` and `[[package]]` arrays with resolved commit hashes.

#### Scenario: Lock file contains marketplace commits
- **WHEN** installation completes
- **THEN** each `[[marketplace]]` entry includes `name`, `url`, and `commit` fields

#### Scenario: Lock file contains package resolution
- **WHEN** installation completes
- **THEN** each `[[package]]` entry includes `name`, `marketplace`, `source_type`, `marketplace_commit`, and `resolved_version` fields

### Requirement: Lock file header

The system SHALL include a header comment in `plugins.lock` indicating it is auto-generated.

#### Scenario: Lock file has warning header
- **WHEN** a lock file is generated
- **THEN** the first lines are comments stating "DO NOT EDIT - Generated by skill-manager"

### Requirement: Global and project manifest locations

The system SHALL look for manifests in two locations:
1. Global: `~/.config/skill-manager/plugins.toml`
2. Project: `./.claude/plugins.toml`

#### Scenario: Project manifest takes precedence for resolution
- **WHEN** both global and project manifests exist
- **THEN** the system processes both, with project plugins potentially overriding global ones

#### Scenario: Global-only installation
- **WHEN** only a global manifest exists
- **THEN** the system installs plugins from the global manifest

